#!/usr/bin/env bash

#
# setup
#
pushd `pwd` # save original path
cd `dirname "$0"` # cd to script path
./common/check-dependencies "weechat weechat-plugins gnutls gpm python-potr openssl" || exit $? # 


#
# script
#
echo "----- enabling tor..."

weechat -r "/proxy add tor socks5 127.0.0.1 9050;/quit"

echo "----- enabling otr..."

weechat -r "/script install otr.py;/wait 500ms /quit"

echo "----- enabling ui niceties..."

weechat -r "/mouse enable;/script install buffers.pl;/wait 500ms /quit"

echo "----- configuring irc servers..."

declare -a server_names=("autistici" \
                           "freenode" \
                           "indymedia" \
                           "oftc")

declare -a server_domains=("irc.autistici.org/6697 -ssl"\
                             "freenodeok2gncmy.onion"\
                             "irc.indymedia.org/6697 -ssl"\
                             "irc.oftc.net/6697 -ssl")

for i in ${!server_names[@]}
do
  weechat -r "/server add ${server_names[i]} ${server_domains[i]} -autoconnect;/quit"
  weechat -r "/set irc.server.${server_names[i]}.proxy 'tor';/quit"
done

# TODO
# - create .env files w/ nicks & passwords for given user on given servers
# - enable SASL & register nicks for indymedia, oftc, freenode
#  (*must* do this to connect to either oftc or freenode )
# - create a `run-weechat` script that identifies all nicks

#
# cleanup
#
popd
